{{- if .Values.crds.install }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    {{- include "kyverno-authz-server.labels" . | nindent 4 }}
    {{- with .Values.crds.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    {{- with .Values.crds.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    controller-gen.kubebuilder.io/version: v0.19.0
  name: authorizationservers.authz.kyverno.io
spec:
  group: authz.kyverno.io
  names:
    categories:
    - kyverno
    kind: AuthorizationServer
    listKind: AuthorizationServerList
    plural: authorizationservers
    singular: authorizationserver
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: AuthorizationServer is a resource that represents a new kyverno
          authorization server.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AuthorizationServerSpec defines the spec of a authorization
              server.
            properties:
              sources:
                description: AuthorizationServerPolicySource contains all the sources
                  of policies for the authorization server.
                items:
                  description: AuthorizationServerPolicySource represents where the
                    authorization server will get its policies from.
                  maxProperties: 1
                  minProperties: 1
                  properties:
                    external:
                      description: ExternalSource defines an external policy source.
                      properties:
                        url:
                          description: |-
                            URL is the URL of the external policy source
                            Supported schemes are: file://, oci://, https://, etc
                          type: string
                      required:
                      - url
                      type: object
                    kubernetes:
                      description: KubernetesPolicySource defines a reference to a
                        Kubernetes policy resource.
                      properties:
                        policyRef:
                          description: |-
                            PolicyRef is a reference to Kubernetes policy resources.
                            When omitted, all ValidatingPolicy resources in the cluster are selected.
                            When present, filters policies by name or selector.
                          properties:
                            group:
                              default: policies.kyverno.io
                              description: |-
                                Group is the group of the referent. For example, "policies.kyverno.io".
                                When unspecified or empty string, core API group is inferred.
                              maxLength: 253
                              pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                              type: string
                            kind:
                              default: ValidatingPolicy
                              description: Kind is the kind of the referent. For example,
                                "ValidatingPolicy".
                              maxLength: 63
                              minLength: 1
                              pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                              type: string
                            name:
                              description: |-
                                Name is the name of the referent.
                                Mutually exclusive with Selector.
                              maxLength: 253
                              minLength: 1
                              type: string
                            selector:
                              description: |-
                                Selector is a label selector to select the Kubernetes policy resource.
                                Mutually exclusive with Name.
                              properties:
                                matchExpressions:
                                  description: matchExpressions is a list of label
                                    selector requirements. The requirements are ANDed.
                                  items:
                                    description: |-
                                      A label selector requirement is a selector that contains values, a key, and an operator that
                                      relates the key and values.
                                    properties:
                                      key:
                                        description: key is the label key that the
                                          selector applies to.
                                        type: string
                                      operator:
                                        description: |-
                                          operator represents a key's relationship to a set of values.
                                          Valid operators are In, NotIn, Exists and DoesNotExist.
                                        type: string
                                      values:
                                        description: |-
                                          values is an array of string values. If the operator is In or NotIn,
                                          the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                          the values array must be empty. This array is replaced during a strategic
                                          merge patch.
                                        items:
                                          type: string
                                        type: array
                                        x-kubernetes-list-type: atomic
                                    required:
                                    - key
                                    - operator
                                    type: object
                                  type: array
                                  x-kubernetes-list-type: atomic
                                matchLabels:
                                  additionalProperties:
                                    type: string
                                  description: |-
                                    matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                    map is equivalent to an element of matchExpressions, whose key field is "key", the
                                    operator is "In", and the values array contains only "value". The requirements are ANDed.
                                  type: object
                              type: object
                              x-kubernetes-map-type: atomic
                          type: object
                          x-kubernetes-validations:
                          - message: either name or selector must be specified
                            rule: has(self.name) || has(self.selector)
                          - message: name and selector are mutually exclusive
                            rule: '!(has(self.name) && has(self.selector))'
                      type: object
                    oci:
                      description: |-
                        OciPolicySource defines the configuration for fetching policies
                        from an OCI (Open Container Initiative) registry.
                      properties:
                        allowInsecureRegistry:
                          description: |-
                            AllowInsecureRegistry indicates whether connections to an
                            insecure (HTTP or self-signed HTTPS) registry are permitted.
                            This should generally be false in production environments
                            to ensure secure communication.
                          type: boolean
                        imagePullSecrets:
                          description: |-
                            ImagePullSecrets lists the names of Kubernetes secrets that
                            contain credentials needed to authenticate with the OCI registry.
                            These are typically referenced in Kubernetes to pull images
                            from private registries.
                          items:
                            type: string
                          type: array
                        url:
                          description: |-
                            URL specifies the location of the OCI registry or image
                            that contains the policy definitions.
                          type: string
                      required:
                      - url
                      type: object
                  type: object
                type: array
              type:
                description: Type defines the type of authorization server.
                maxProperties: 1
                minProperties: 1
                properties:
                  envoy:
                    description: Envoy configures an Envoy-based authorization server.
                    properties:
                      address:
                        description: Address is the network address the server listens
                          on.
                        type: string
                      network:
                        default: tcp
                        description: Network is the network the server listens on.
                        type: string
                    required:
                    - address
                    type: object
                  http:
                    description: HTTP configures a custom HTTP authorization server.
                    properties:
                      modifiers:
                        description: Modifiers to apply to requests and responses.
                        properties:
                          request:
                            description: Request is a script or expression for modifying
                              the incoming request.
                            type: string
                          response:
                            description: Response is a script or expression for modifying
                              the outgoing response.
                            type: string
                        type: object
                      port:
                        description: Port is the port the server listens on.
                        type: integer
                    type: object
                type: object
            required:
            - type
            type: object
        type: object
    served: true
    storage: true
{{- end }}
