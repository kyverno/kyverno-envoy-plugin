<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kyverno programmable, policy-based authz servers"><link href=https://kyverno.github.io/kyverno-envoy-plugin/main/performance/ rel=canonical><link rel=icon href=../static/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>Performance - Kyverno Authz Server</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../static/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Performance - Kyverno Authz Server"><meta property=og:description content="Kyverno programmable, policy-based authz servers"><meta property=og:image content=https://kyverno.github.io/kyverno-envoy-plugin/main/assets/images/social/performance/index.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://kyverno.github.io/kyverno-envoy-plugin/main/performance/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Performance - Kyverno Authz Server"><meta name=twitter:description content="Kyverno programmable, policy-based authz servers"><meta name=twitter:image content=https://kyverno.github.io/kyverno-envoy-plugin/main/assets/images/social/performance/index.png><meta property=og:type content=website><meta property=og:title content="Kyverno Authz Server - Performance"><meta property=og:description content="Kyverno programmable, policy-based authz servers"><meta content=https://kyverno.github.io/kyverno-envoy-plugin/main/performance/ property=og:url><meta property=og:image content=https://kyverno.github.io/kyverno-envoy-plugin/main/static/card.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@goreleaser><meta name=twitter:creator content=@goreleaser><meta name=twitter:title content="Kyverno Authz Server - Performance"><meta name=twitter:description content="Kyverno programmable, policy-based authz servers"><meta name=twitter:image content=https://kyverno.github.io/kyverno-envoy-plugin/main/static/card.png></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#performance class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL(".."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Kyverno Authz Server" class="md-header__button md-logo" aria-label="Kyverno Authz Server" data-md-component=logo> <img src=../static/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kyverno Authz Server </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Performance </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=light-blue data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/kyverno/kyverno-envoy-plugin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> kyverno/kyverno-envoy-plugin </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../quick-start/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../policies/ class=md-tabs__link> Policies </a> </li> <li class=md-tabs__item> <a href=../tutorials/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../reference/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../community/ class=md-tabs__link> Community </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Kyverno Authz Server" class="md-nav__button md-logo" aria-label="Kyverno Authz Server" data-md-component=logo> <img src=../static/logo.png alt=logo> </a> Kyverno Authz Server </label> <div class=md-nav__source> <a href=https://github.com/kyverno/kyverno-envoy-plugin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> kyverno/kyverno-envoy-plugin </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../quick-start/ class="md-nav__link "> <span class=md-ellipsis> Getting Started </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../quick-start/kube-install/ class=md-nav__link> <span class=md-ellipsis> Kubernetes installation </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/local-install/ class=md-nav__link> <span class=md-ellipsis> Local installation </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/completion/ class=md-nav__link> <span class=md-ellipsis> Shell Completion </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/policy-sources/ class=md-nav__link> <span class=md-ellipsis> Policy sources </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/first-policy/ class=md-nav__link> <span class=md-ellipsis> First policy </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/http-authz-server/ class=md-nav__link> <span class=md-ellipsis> HTTP Authz Server </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/envoy-authz-server/ class=md-nav__link> <span class=md-ellipsis> Envoy Authz Server </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/envoy/ class=md-nav__link> <span class=md-ellipsis> Envoy </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/http/ class=md-nav__link> <span class=md-ellipsis> HTTP </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/sidecar-injector/ class=md-nav__link> <span class=md-ellipsis> Sidecar Injector </span> </a> </li> <li class=md-nav__item> <a href=../quick-start/next-steps/ class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_13> <label class=md-nav__link for=__nav_2_13 id=__nav_2_13_label tabindex=0> <span class=md-ellipsis> Install </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> Install </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install/crds/ class=md-nav__link> <span class=md-ellipsis> CRDs </span> </a> </li> <li class=md-nav__item> <a href=../install/certificates/ class=md-nav__link> <span class=md-ellipsis> Certificates management </span> </a> </li> <li class=md-nav__item> <a href=../install/external-policy-source/ class=md-nav__link> <span class=md-ellipsis> External policy sources </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../policies/ class="md-nav__link "> <span class=md-ellipsis> Policies </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Policies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../policies/envoy-policy-breakdown/ class=md-nav__link> <span class=md-ellipsis> Envoy Policy Breakdown </span> </a> </li> <li class=md-nav__item> <a href=../policies/http-policy-breakdown/ class=md-nav__link> <span class=md-ellipsis> HTTP Policy Breakdown </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <div class="md-nav__link md-nav__container"> <a href=../cel-extensions/ class="md-nav__link "> <span class=md-ellipsis> CEL extensions </span> </a> <label class="md-nav__link " for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> CEL extensions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cel-extensions/envoy/ class=md-nav__link> <span class=md-ellipsis> Envoy library </span> </a> </li> <li class=md-nav__item> <a href=../cel-extensions/json/ class=md-nav__link> <span class=md-ellipsis> JSON library </span> </a> </li> <li class=md-nav__item> <a href=../cel-extensions/jwk/ class=md-nav__link> <span class=md-ellipsis> Jwk library </span> </a> </li> <li class=md-nav__item> <a href=../cel-extensions/jwt/ class=md-nav__link> <span class=md-ellipsis> Jwt library </span> </a> </li> <li class=md-nav__item> <a href=../cel-extensions/http/ class=md-nav__link> <span class=md-ellipsis> HTTP library </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../tutorials/ class="md-nav__link "> <span class=md-ellipsis> Tutorials </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tutorials/istio/ class=md-nav__link> <span class=md-ellipsis> Istio </span> </a> </li> <li class=md-nav__item> <a href=../tutorials/envoy-gateway/ class=md-nav__link> <span class=md-ellipsis> Envoy Gateway </span> </a> </li> <li class=md-nav__item> <a href=../tutorials/kgateway/ class=md-nav__link> <span class=md-ellipsis> KGateway </span> </a> </li> <li class=md-nav__item> <a href=../tutorials/ingress-nginx/ class=md-nav__link> <span class=md-ellipsis> Ingress Nginx </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../reference/ class="md-nav__link "> <span class=md-ellipsis> Reference </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/json-schemas/ class=md-nav__link> <span class=md-ellipsis> JSON schemas </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> APIs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> APIs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/apis/policies.kyverno.io.v1alpha1/ class=md-nav__link> <span class=md-ellipsis> policies.kyverno.io/v1alpha1 </span> </a> </li> <li class=md-nav__item> <a href=../reference/apis/authz.kyverno.io.v1alpha1/ class=md-nav__link> <span class=md-ellipsis> authz.kyverno.io/v1alpha1 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> Command Line </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Command Line </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_completion/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin completion </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_completion_bash/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin completion bash </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_completion_fish/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin completion fish </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_completion_powershell/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin completion powershell </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_completion_zsh/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin completion zsh </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_run/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin run </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_control-plane/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve control-plane </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_envoy/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve envoy </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_envoy_authz-server/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve envoy authz-server </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_envoy_validation-webhook/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve envoy validation-webhook </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_http/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve http </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_http_authz-server/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve http authz-server </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_http_validation-webhook/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve http validation-webhook </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_serve_sidecar-injector/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin serve sidecar-injector </span> </a> </li> <li class=md-nav__item> <a href=../reference/commands/kyverno-envoy-plugin_version/ class=md-nav__link> <span class=md-ellipsis> kyverno-envoy-plugin version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../community/ class="md-nav__link "> <span class=md-ellipsis> Community </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../community/contribute/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../community/reporting-a-bug/ class=md-nav__link> <span class=md-ellipsis> Reporting a bug </span> </a> </li> <li class=md-nav__item> <a href=../community/reporting-a-docs-issue/ class=md-nav__link> <span class=md-ellipsis> Reporting a docs issue </span> </a> </li> <li class=md-nav__item> <a href=../community/requesting-a-change/ class=md-nav__link> <span class=md-ellipsis> Requesting a change </span> </a> </li> <li class=md-nav__item> <a href=../community/making-a-pull-request/ class=md-nav__link> <span class=md-ellipsis> Making a pull request </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#benchmark-setup class=md-nav__link> <span class=md-ellipsis> Benchmark Setup </span> </a> <nav class=md-nav aria-label="Benchmark Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sample-application class=md-nav__link> <span class=md-ellipsis> Sample Application </span> </a> </li> <li class=md-nav__item> <a href=#envoy class=md-nav__link> <span class=md-ellipsis> Envoy </span> </a> </li> <li class=md-nav__item> <a href=#kyverno-authz-server class=md-nav__link> <span class=md-ellipsis> Kyverno Authz Server </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#benchmark-scenarios class=md-nav__link> <span class=md-ellipsis> Benchmark Scenarios </span> </a> </li> <li class=md-nav__item> <a href=#load-testing-with-k6 class=md-nav__link> <span class=md-ellipsis> Load Testing with k6 </span> </a> </li> <li class=md-nav__item> <a href=#measuring-performance class=md-nav__link> <span class=md-ellipsis> Measuring Performance </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/kyverno/kyverno-envoy-plugin/edit/main/website/docs/performance/index.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/kyverno/kyverno-envoy-plugin/raw/main/website/docs/performance/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=performance>Performance<a class=headerlink href=#performance title="Permanent link">&para;</a></h1> <p>This page offers guidance and best practices for benchmarking the performance of the Kyverno Authz Server, helping users understand the associated overhead. It outlines an example setup for conducting benchmarks, various benchmarking scenarios, and key metrics to capture for assessing the impact of the Kyverno Authz Server.</p> <h2 id=benchmark-setup>Benchmark Setup<a class=headerlink href=#benchmark-setup title="Permanent link">&para;</a></h2> <p>The benchmark setup consists of the following components:</p> <h3 id=sample-application>Sample Application<a class=headerlink href=#sample-application title="Permanent link">&para;</a></h3> <p>The first component is a simple Go application that provides information of books in the library books collection and exposes APIs to <code>get</code>, <code>create</code> and <code>delete</code> books collection. Check this out for more information about the <a href=https://github.com/Sanskarzz/kyverno-envoy-demos/tree/main/test-application>Go test application</a> . </p> <h3 id=envoy>Envoy<a class=headerlink href=#envoy title="Permanent link">&para;</a></h3> <p>The second component is the Envoy proxy, which runs alongside the example application. The Envoy configuration defines an external authorization filter <code>envoy.ext_authz</code> for a gRPC authorization server.</p> <p>The config uses Envoy's in-built gRPC client to make external gRPC calls.</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>static_resources</span><span class=p>:</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>  </span><span class=nt>listeners</span><span class=p>:</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>address</span><span class=p>:</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>      </span><span class=nt>socket_address</span><span class=p>:</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>        </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>        </span><span class=nt>port_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=nt>filter_chains</span><span class=p>:</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>filters</span><span class=p>:</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.network.http_connection_manager</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>        </span><span class=nt>typed_config</span><span class=p>:</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>          </span><span class=s>&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>          </span><span class=nt>codec_type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>          </span><span class=nt>stat_prefix</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ingress_http</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>          </span><span class=nt>route_config</span><span class=p>:</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local_route</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>            </span><span class=nt>virtual_hosts</span><span class=p>:</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>              </span><span class=nt>domains</span><span class=p>:</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>              </span><span class=nt>routes</span><span class=p>:</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>match</span><span class=p>:</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>                  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/&quot;</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>                </span><span class=nt>route</span><span class=p>:</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>                  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>          </span><span class=nt>http_filters</span><span class=p>:</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">envoy.ext_authz</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>            </span><span class=nt>typed_config</span><span class=p>:</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=w>              </span><span class=s>&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=w>              </span><span class=nt>transport_api_version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">V3</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=w>              </span><span class=nt>with_request_body</span><span class=p>:</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=w>                </span><span class=nt>max_request_bytes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=w>                </span><span class=nt>allow_partial_message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=w>              </span><span class=nt>failure_mode_allow</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=w>              </span><span class=nt>grpc_service</span><span class=p>:</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=w>                </span><span class=nt>google_grpc</span><span class=p>:</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=w>                  </span><span class=nt>target_uri</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:9191</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>                  </span><span class=nt>stat_prefix</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext_authz</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>                </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.5s</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">envoy.filters.http.router</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=w>            </span><span class=nt>typed_config</span><span class=p>:</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=w>              </span><span class=s>&quot;@type&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">type.googleapis.com/envoy.extensions.filters.http.router.v3.Router</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=w>  </span><span class=nt>clusters</span><span class=p>:</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=w>    </span><span class=nt>connect_timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.25s</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">strict_dns</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=w>    </span><span class=nt>lb_policy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">round_robin</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=w>    </span><span class=nt>load_assignment</span><span class=p>:</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=w>      </span><span class=nt>cluster_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=w>      </span><span class=nt>endpoints</span><span class=p>:</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>lb_endpoints</span><span class=p>:</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>endpoint</span><span class=p>:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=w>            </span><span class=nt>address</span><span class=p>:</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=w>              </span><span class=nt>socket_address</span><span class=p>:</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=w>                </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a><span class=w>                </span><span class=nt>port_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=nt>admin</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=w>  </span><span class=nt>access_log_path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/dev/null&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a><span class=w>  </span><span class=nt>address</span><span class=p>:</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a><span class=w>    </span><span class=nt>socket_address</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a><span class=w>      </span><span class=nt>port_value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8001</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a><span class=nt>layered_runtime</span><span class=p>:</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a><span class=w>  </span><span class=nt>layers</span><span class=p>:</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">static_layer_0</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a><span class=w>      </span><span class=nt>static_layer</span><span class=p>:</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a><span class=w>        </span><span class=nt>envoy</span><span class=p>:</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a><span class=w>          </span><span class=nt>resource_limits</span><span class=p>:</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a><span class=w>            </span><span class=nt>listener</span><span class=p>:</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a><span class=w>              </span><span class=nt>example_listener_name</span><span class=p>:</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a><span class=w>                </span><span class=nt>connection_limit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a><span class=w>        </span><span class=nt>overload</span><span class=p>:</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a><span class=w>          </span><span class=nt>global_downstream_max_connections</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50000</span>
</span></code></pre></div> <h3 id=kyverno-authz-server>Kyverno Authz Server<a class=headerlink href=#kyverno-authz-server title="Permanent link">&para;</a></h3> <p>The third component is the Kyverno Authz Server itself, which is configured to load and enforce Kyverno policies on incoming requests. </p> <h2 id=benchmark-scenarios>Benchmark Scenarios<a class=headerlink href=#benchmark-scenarios title="Permanent link">&para;</a></h2> <p>The following scenarios should be tested to compare the performance of the Kyverno Authz Server under different conditions:</p> <ol> <li><strong>App Only</strong>: Requests are sent directly to the application, without Envoy or the Kyverno Authz Server.</li> <li><strong>App and Envoy</strong>: Envoy is included in the request path, but the Kyverno Authz Server is not (i.e., Envoy External Authorization API is disabled).</li> <li><strong>App, Envoy, and Kyverno</strong>: Envoy External Authorization API is enabled, and a sample real-world policy is loaded into the Kyverno Authz Server.</li> </ol> <h2 id=load-testing-with-k6>Load Testing with k6<a class=headerlink href=#load-testing-with-k6 title="Permanent link">&para;</a></h2> <p>To perform load testing, we'll use the k6 tool. Follow these steps:</p> <ol> <li> <p><strong>Install k6</strong>: Install <a href=https://k6.io/docs/getting-started/installation>k6</a> on your machine by following the instructions on the official website.</p> </li> <li> <p><strong>Write the k6 script</strong>: Below is the example k6 script. </p> </li> </ol> <div class="language-js highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>import</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;k6/http&#39;</span><span class=p>;</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>check</span><span class=p>,</span><span class=w> </span><span class=nx>group</span><span class=p>,</span><span class=w> </span><span class=nx>sleep</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;k6&#39;</span><span class=p>;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=nx>stages</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>duration</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;30s&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>target</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=c1>// Ramp-up to 100 virtual users over 30 seconds</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>duration</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;1m&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>target</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=c1>// Stay at 100 virtual users for 1 minute</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=p>{</span><span class=w> </span><span class=nx>duration</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;30s&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>target</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=c1>// Ramp-down to 0 virtual users over 30 seconds</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=p>};</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=cm>/*</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=cm>Replace ip for every scenerio</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=cm>export SERVICE_PORT=$(kubectl -n demo get service testapp -o jsonpath=&#39;{.spec.ports[?(@.port==8080)].nodePort}&#39;)</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=cm>export SERVICE_HOST=$(minikube ip)</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=cm>export SERVICE_URL=$SERVICE_HOST:$SERVICE_PORT</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=cm>echo $SERVICE_URL</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=cm>http://192.168.49.2:31541</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=cm>*/</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=kd>const</span><span class=w> </span><span class=nx>BASE_URL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;http://192.168.49.2:31541&#39;</span><span class=p>;</span><span class=w> </span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>  </span><span class=nx>group</span><span class=p>(</span><span class=s1>&#39;GET /book with guest token&#39;</span><span class=p>,</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>BASE_URL</span><span class=si>}</span><span class=sb>/book`</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>      </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s1>&#39;Authorization&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjIyNDEwODE1MzksIm5iZiI6MTUxNDg1MTEzOSwicm9sZSI6Imd1ZXN0Iiwic3ViIjoiWVd4cFkyVT0ifQ.ja1bgvIt47393ba_WbSBm35NrUhdxM4mOVQN8iXz8lk&#39;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=nx>check</span><span class=p>(</span><span class=nx>res</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>      </span><span class=s1>&#39;is status 200&#39;</span><span class=o>:</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>200</span><span class=p>,</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>  </span><span class=nx>sleep</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=c1>// Sleep for 1 second between iterations</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=p>}</span>
</span></code></pre></div> <ol> <li><strong>Run the k6 test</strong>: Run the load test with the following command:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>k6<span class=w> </span>run<span class=w> </span>-f<span class=w> </span>-<span class=w> </span><span class=s>&lt;&lt;EOF</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=s>import http from &#39;k6/http&#39;;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=s>import { check, group, sleep } from &#39;k6&#39;;</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=s>export const options = {</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=s>  stages: [</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=s>    { duration: &#39;30s&#39;, target: 100 }, // Ramp-up to 100 virtual users over 30 seconds</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=s>    { duration: &#39;1m&#39;, target: 100 }, // Stay at 100 virtual users for 1 minute</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=s>    { duration: &#39;30s&#39;, target: 0 }, // Ramp-down to 0 virtual users over 30 seconds</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=s>  ],</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=s>};</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=s>const BASE_URL = &#39;http://192.168.49.2:31700&#39;; // Replace with your application URL </span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=s>export default function () {</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=s>  group(&#39;GET /book with guest token&#39;, () =&gt; {</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=s>    const res = http.get(`${BASE_URL}/book`, {</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=s>      headers: { &#39;Authorization&#39;: &#39;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjIyNDEwODE1MzksIm5iZiI6MTUxNDg1MTEzOSwicm9sZSI6Imd1ZXN0Iiwic3ViIjoiWVd4cFkyVT0ifQ.ja1bgvIt47393ba_WbSBm35NrUhdxM4mOVQN8iXz8lk&#39; },</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=s>    });</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=s>    check(res, {</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=s>      &#39;is status 200&#39;: (r) =&gt; r.status === 200,</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=s>    });</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=s>  });</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=s>  sleep(1); // Sleep for 1 second between iterations</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=s>}</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=s>EOF</span>
</span></code></pre></div> <ol> <li><strong>Analyze the results</strong>: Generate an json report with detailed insight by running:</li> </ol> <p><div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>k6<span class=w> </span>run<span class=w> </span>--out<span class=w> </span><span class=nv>json</span><span class=o>=</span>report.json<span class=w> </span>k6-script.js
</span></code></pre></div> 5. <strong>Repeat for different scenarios</strong>:</p> <ul> <li> <p><strong>App only</strong></p> <p>In this case , request are sent directly to the sample application ie no Envoy and Kyverno-plugin in the request path . For this run this command to apply the sample applicaition and then test with k6</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kyverno/kyverno-envoy-plugin/main/tests/performance-test/manifest/app.yaml
</span></code></pre></div> <p>Results of the k6 when only application is applied</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=w>        </span>/<span class=se>\ </span><span class=w>     </span><span class=p>|</span><span class=p>|</span><span class=w> </span>//<span class=w>   </span>//<span class=w>   </span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>   </span>/<span class=se>\ </span><span class=w> </span>/<span class=w>  </span><span class=se>\ </span><span class=w>    </span><span class=p>|</span><span class=w>  </span><span class=p>|</span>/<span class=w>  </span>/<span class=w>   </span>/<span class=w>  </span>/<span class=w>    </span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span>/<span class=w>  </span><span class=se>\/</span><span class=w>    </span><span class=se>\ </span><span class=w>   </span><span class=p>|</span><span class=w>     </span><span class=o>(</span><span class=w>   </span>/<span class=w>   </span><span class=se>\ </span><span class=w> </span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w> </span>/<span class=w>          </span><span class=se>\ </span><span class=w>  </span><span class=p>|</span><span class=w>  </span><span class=p>|</span><span class=se>\ </span><span class=w> </span><span class=se>\ </span><span class=p>|</span><span class=w>  </span><span class=o>(</span><span class=o>)</span><span class=w>  </span><span class=p>|</span><span class=w> </span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>/<span class=w> </span>__________<span class=w> </span><span class=se>\ </span><span class=w> </span><span class=p>|</span>__<span class=p>|</span><span class=w> </span><span class=se>\_</span>_<span class=se>\ \_</span>____/<span class=w> </span>.io
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w> </span>execution:<span class=w> </span><span class=nb>local</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span>script:<span class=w> </span>k6-script.js
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span>output:<span class=w> </span>-
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w> </span>scenarios:<span class=w> </span><span class=o>(</span><span class=m>100</span>.00%<span class=o>)</span><span class=w> </span><span class=m>1</span><span class=w> </span>scenario,<span class=w> </span><span class=m>100</span><span class=w> </span>max<span class=w> </span>VUs,<span class=w> </span>2m30s<span class=w> </span>max<span class=w> </span>duration<span class=w> </span><span class=o>(</span>incl.<span class=w> </span>graceful<span class=w> </span>stop<span class=o>)</span>:
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>          </span>*<span class=w> </span>default:<span class=w> </span>Up<span class=w> </span>to<span class=w> </span><span class=m>100</span><span class=w> </span>looping<span class=w> </span>VUs<span class=w> </span><span class=k>for</span><span class=w> </span>2m0s<span class=w> </span>over<span class=w> </span><span class=m>3</span><span class=w> </span>stages<span class=w> </span><span class=o>(</span>gracefulRampDown:<span class=w> </span>30s,<span class=w> </span>gracefulStop:<span class=w> </span>30s<span class=o>)</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w> </span><span class=w> </span>GET<span class=w> </span>/book<span class=w> </span>with<span class=w> </span>guest<span class=w> </span>token
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>   </span><span class=w> </span>is<span class=w> </span>status<span class=w> </span><span class=m>200</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w> </span>checks.........................:<span class=w> </span><span class=m>100</span>.00%<span class=w> </span><span class=w> </span><span class=m>9048</span><span class=w>      </span><span class=w> </span><span class=m>0</span><span class=w>    </span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w> </span>data_received..................:<span class=w> </span><span class=m>2</span>.1<span class=w> </span>MB<span class=w>  </span><span class=m>18</span><span class=w> </span>kB/s
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w> </span>data_sent......................:<span class=w> </span><span class=m>2</span>.6<span class=w> </span>MB<span class=w>  </span><span class=m>21</span><span class=w> </span>kB/s
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w> </span>group_duration.................:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>1</span>.01ms<span class=w>   </span><span class=nv>min</span><span class=o>=</span><span class=m>166</span>.46s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>775</span>.01s<span class=w> </span><span class=nv>max</span><span class=o>=</span>36ms<span class=w>    </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>1</span>.72ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>2</span>.31ms<span class=w>  </span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w> </span>http_req_blocked...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>15</span>.08s<span class=w>  </span><span class=nv>min</span><span class=o>=</span><span class=m>1</span>.55s<span class=w>   </span><span class=nv>med</span><span class=o>=</span><span class=m>6</span>.54s<span class=w>   </span><span class=nv>max</span><span class=o>=</span><span class=m>4</span>.09ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>12</span>.07s<span class=w>  </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>15</span>.25s<span class=w> </span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w> </span>http_req_connecting............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>4</span>.58s<span class=w>   </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>max</span><span class=o>=</span><span class=m>1</span>.57ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w> </span>http_req_duration..............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>745</span>.73s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>103</span>.06s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>549</span>.17s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>35</span>.88ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>1</span>.26ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>1</span>.75ms<span class=w>  </span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>   </span><span class=o>{</span><span class=w> </span>expected_response:true<span class=w> </span><span class=o>}</span>...:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>745</span>.73s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>103</span>.06s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>549</span>.17s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>35</span>.88ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>1</span>.26ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>1</span>.75ms<span class=w>  </span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w> </span>http_req_failed................:<span class=w> </span><span class=m>0</span>.00%<span class=w>   </span><span class=w> </span><span class=m>0</span><span class=w>         </span><span class=w> </span><span class=m>9048</span><span class=w> </span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w> </span>http_req_receiving.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>119</span>.69s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>11</span>.33s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>77</span>.78s<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>10</span>.97ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>193</span>.73s<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>285</span>.58s
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w> </span>http_req_sending...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>41s<span class=w>     </span><span class=nv>min</span><span class=o>=</span><span class=m>6</span>.96s<span class=w>   </span><span class=nv>med</span><span class=o>=</span><span class=m>31</span>.12s<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>2</span>.39ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>61</span>.88s<span class=w>  </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>78</span>.15s<span class=w> </span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w> </span>http_req_tls_handshaking.......:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>max</span><span class=o>=</span>0s<span class=w>      </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w> </span>http_req_waiting...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>585</span>.04s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>75</span>.52s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>407</span>.87s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>35</span>.84ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>965</span>.49s<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>1</span>.33ms<span class=w>  </span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w> </span>http_reqs......................:<span class=w> </span><span class=m>9048</span><span class=w>    </span><span class=m>75</span>.050438/s
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w> </span>iteration_duration.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>1s<span class=w>       </span><span class=nv>min</span><span class=o>=</span>1s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>1s<span class=w>       </span><span class=nv>max</span><span class=o>=</span><span class=m>1</span>.06s<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>1s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>1s<span class=w>      </span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=w> </span>iterations.....................:<span class=w> </span><span class=m>9048</span><span class=w>    </span><span class=m>75</span>.050438/s
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=w> </span>vus............................:<span class=w> </span><span class=m>2</span><span class=w>       </span><span class=nv>min</span><span class=o>=</span><span class=m>2</span><span class=w>       </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w> </span>vus_max........................:<span class=w> </span><span class=m>100</span><span class=w>     </span><span class=nv>min</span><span class=o>=</span><span class=m>100</span><span class=w>     </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>running<span class=w> </span><span class=o>(</span>2m00.6s<span class=o>)</span>,<span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs,<span class=w> </span><span class=m>9048</span><span class=w> </span><span class=nb>complete</span><span class=w> </span>and<span class=w> </span><span class=m>0</span><span class=w> </span>interrupted<span class=w> </span>iterations
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>default<span class=w> </span><span class=w> </span><span class=o>[======================================]</span><span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs<span class=w>  </span>2m0s
</span></code></pre></div> </li> <li> <p><strong>App and Envoy</strong></p> <p>In this case, the Kyverno Authz Server is not included in the path but Envoy is but Envoy External Authorization API disabled For this run this command to apply the sample application with envoy.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kyverno/kyverno-envoy-plugin/main/tests/performance-test/manifest/app-envoy.yaml
</span></code></pre></div> <p>Results of k6 after applying sample-application with envoy.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=w>        </span>/<span class=se>\ </span><span class=w>     </span><span class=p>|</span><span class=p>|</span><span class=w> </span>//<span class=w>   </span>//<span class=w>   </span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>   </span>/<span class=se>\ </span><span class=w> </span>/<span class=w>  </span><span class=se>\ </span><span class=w>    </span><span class=p>|</span><span class=w>  </span><span class=p>|</span>/<span class=w>  </span>/<span class=w>   </span>/<span class=w>  </span>/<span class=w>    </span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>  </span>/<span class=w>  </span><span class=se>\/</span><span class=w>    </span><span class=se>\ </span><span class=w>   </span><span class=p>|</span><span class=w>     </span><span class=o>(</span><span class=w>   </span>/<span class=w>   </span><span class=se>\ </span><span class=w> </span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w> </span>/<span class=w>          </span><span class=se>\ </span><span class=w>  </span><span class=p>|</span><span class=w>  </span><span class=p>|</span><span class=se>\ </span><span class=w> </span><span class=se>\ </span><span class=p>|</span><span class=w>  </span><span class=o>(</span><span class=o>)</span><span class=w>  </span><span class=p>|</span><span class=w> </span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>/<span class=w> </span>__________<span class=w> </span><span class=se>\ </span><span class=w> </span><span class=p>|</span>__<span class=p>|</span><span class=w> </span><span class=se>\_</span>_<span class=se>\ \_</span>____/<span class=w> </span>.io
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w> </span>execution:<span class=w> </span><span class=nb>local</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span>script:<span class=w> </span>k6-script.js
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span>output:<span class=w> </span>-
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w> </span>scenarios:<span class=w> </span><span class=o>(</span><span class=m>100</span>.00%<span class=o>)</span><span class=w> </span><span class=m>1</span><span class=w> </span>scenario,<span class=w> </span><span class=m>100</span><span class=w> </span>max<span class=w> </span>VUs,<span class=w> </span>2m30s<span class=w> </span>max<span class=w> </span>duration<span class=w> </span><span class=o>(</span>incl.<span class=w> </span>graceful<span class=w> </span>stop<span class=o>)</span>:
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>          </span>*<span class=w> </span>default:<span class=w> </span>Up<span class=w> </span>to<span class=w> </span><span class=m>100</span><span class=w> </span>looping<span class=w> </span>VUs<span class=w> </span><span class=k>for</span><span class=w> </span>2m0s<span class=w> </span>over<span class=w> </span><span class=m>3</span><span class=w> </span>stages<span class=w> </span><span class=o>(</span>gracefulRampDown:<span class=w> </span>30s,<span class=w> </span>gracefulStop:<span class=w> </span>30s<span class=o>)</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w> </span><span class=w> </span>GET<span class=w> </span>/book<span class=w> </span>with<span class=w> </span>guest<span class=w> </span>token
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>   </span><span class=w> </span>is<span class=w> </span>status<span class=w> </span><span class=m>200</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w> </span>checks.........................:<span class=w> </span><span class=m>100</span>.00%<span class=w> </span><span class=w> </span><span class=m>9031</span><span class=w>      </span><span class=w> </span><span class=m>0</span><span class=w>    </span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w> </span>data_received..................:<span class=w> </span><span class=m>2</span>.5<span class=w> </span>MB<span class=w>  </span><span class=m>21</span><span class=w> </span>kB/s
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w> </span>data_sent......................:<span class=w> </span><span class=m>2</span>.6<span class=w> </span>MB<span class=w>  </span><span class=m>21</span><span class=w> </span>kB/s
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w> </span>group_duration.................:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>2</span>.66ms<span class=w>  </span><span class=nv>min</span><span class=o>=</span><span class=m>457</span>.22s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>1</span>.8ms<span class=w>   </span><span class=nv>max</span><span class=o>=</span><span class=m>65</span>.53ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>4</span>.85ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>6</span>.58ms<span class=w>  </span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w> </span>http_req_blocked...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>12</span>.81s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>1</span>.52s<span class=w>   </span><span class=nv>med</span><span class=o>=</span><span class=m>5</span>.98s<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>2</span>.41ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>11</span>.84s<span class=w>  </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>13</span>.9s<span class=w>  </span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w> </span>http_req_connecting............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>3</span>.82s<span class=w>  </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>max</span><span class=o>=</span><span class=m>2</span>.34ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w> </span>http_req_duration..............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>2</span>.38ms<span class=w>  </span><span class=nv>min</span><span class=o>=</span><span class=m>383</span>.7s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>1</span>.58ms<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>65</span>.22ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>4</span>.36ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>5</span>.92ms<span class=w>  </span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>   </span><span class=o>{</span><span class=w> </span>expected_response:true<span class=w> </span><span class=o>}</span>...:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>2</span>.38ms<span class=w>  </span><span class=nv>min</span><span class=o>=</span><span class=m>383</span>.7s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>1</span>.58ms<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>65</span>.22ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>4</span>.36ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>5</span>.92ms<span class=w>  </span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w> </span>http_req_failed................:<span class=w> </span><span class=m>0</span>.00%<span class=w>   </span><span class=w> </span><span class=m>0</span><span class=w>         </span><span class=w> </span><span class=m>9031</span><span class=w> </span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w> </span>http_req_receiving.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>136</span>.3s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>12</span>.53s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>76</span>.74s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>12</span>.75ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>183</span>.23s<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>272</span>.91s
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w> </span>http_req_sending...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>41</span>.54s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>6</span>.58s<span class=w>   </span><span class=nv>med</span><span class=o>=</span><span class=m>28</span>.1s<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>4</span>.15ms<span class=w>  </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>59</span>.62s<span class=w>  </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>74</span>.85s<span class=w> </span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w> </span>http_req_tls_handshaking.......:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>max</span><span class=o>=</span>0s<span class=w>      </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w> </span>http_req_waiting...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>2</span>.2ms<span class=w>   </span><span class=nv>min</span><span class=o>=</span><span class=m>349</span>.23s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>1</span>.43ms<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>65</span>.08ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>4</span>.05ms<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>5</span>.52ms<span class=w>  </span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w> </span>http_reqs......................:<span class=w> </span><span class=m>9031</span><span class=w>    </span><span class=m>74</span>.825497/s
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=w> </span>iteration_duration.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>1s<span class=w>      </span><span class=nv>min</span><span class=o>=</span>1s<span class=w>       </span><span class=nv>med</span><span class=o>=</span>1s<span class=w>      </span><span class=nv>max</span><span class=o>=</span><span class=m>1</span>.06s<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>1s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>1s<span class=w>      </span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w> </span>iterations.....................:<span class=w> </span><span class=m>9031</span><span class=w>    </span><span class=m>74</span>.825497/s
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w> </span>vus............................:<span class=w> </span><span class=m>3</span><span class=w>       </span><span class=nv>min</span><span class=o>=</span><span class=m>3</span><span class=w>       </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w> </span>vus_max........................:<span class=w> </span><span class=m>100</span><span class=w>     </span><span class=nv>min</span><span class=o>=</span><span class=m>100</span><span class=w>     </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>running<span class=w> </span><span class=o>(</span>2m00.7s<span class=o>)</span>,<span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs,<span class=w> </span><span class=m>9031</span><span class=w> </span><span class=nb>complete</span><span class=w> </span>and<span class=w> </span><span class=m>0</span><span class=w> </span>interrupted<span class=w> </span>iterations
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>default<span class=w> </span><span class=w> </span><span class=o>[======================================]</span><span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs<span class=w>  </span>2m0s
</span></code></pre></div> </li> <li> <p><strong>App, Envoy and Kyverno Authz Server</strong></p> <p>In this case, performance measurements are observed with Envoy External Authorization API enabled and a sample real-world policy loaded into the Kyverno Authz Server.</p> <p>For this apply this command to apply sample-application, envoy and Kyverno Authz Server:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/kyverno/kyverno-envoy-plugin/main/tests/performance-test/manifest/app-envoy-plugin.yaml
</span></code></pre></div> <p>Results of k6 after applying sample-application, Envoy and the Kyverno Authz Server.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=w>        </span>/<span class=se>\ </span><span class=w>     </span><span class=p>|</span><span class=p>|</span><span class=w> </span>//<span class=w>   </span>//<span class=w>   </span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>   </span>/<span class=se>\ </span><span class=w> </span>/<span class=w>  </span><span class=se>\ </span><span class=w>    </span><span class=p>|</span><span class=w>  </span><span class=p>|</span>/<span class=w>  </span>/<span class=w>   </span>/<span class=w>  </span>/<span class=w>    </span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span>/<span class=w>  </span><span class=se>\/</span><span class=w>    </span><span class=se>\ </span><span class=w>   </span><span class=p>|</span><span class=w>     </span><span class=o>(</span><span class=w>   </span>/<span class=w>   </span><span class=se>\ </span><span class=w> </span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w> </span>/<span class=w>          </span><span class=se>\ </span><span class=w>  </span><span class=p>|</span><span class=w>  </span><span class=p>|</span><span class=se>\ </span><span class=w> </span><span class=se>\ </span><span class=p>|</span><span class=w>  </span><span class=o>(</span><span class=o>)</span><span class=w>  </span><span class=p>|</span><span class=w> </span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>/<span class=w> </span>__________<span class=w> </span><span class=se>\ </span><span class=w> </span><span class=p>|</span>__<span class=p>|</span><span class=w> </span><span class=se>\_</span>_<span class=se>\ \_</span>____/<span class=w> </span>.io
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w> </span>execution:<span class=w> </span><span class=nb>local</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>    </span>script:<span class=w> </span>k6-script.js
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span>output:<span class=w> </span>-
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w> </span>scenarios:<span class=w> </span><span class=o>(</span><span class=m>100</span>.00%<span class=o>)</span><span class=w> </span><span class=m>1</span><span class=w> </span>scenario,<span class=w> </span><span class=m>100</span><span class=w> </span>max<span class=w> </span>VUs,<span class=w> </span>2m30s<span class=w> </span>max<span class=w> </span>duration<span class=w> </span><span class=o>(</span>incl.<span class=w> </span>graceful<span class=w> </span>stop<span class=o>)</span>:
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>          </span>*<span class=w> </span>default:<span class=w> </span>Up<span class=w> </span>to<span class=w> </span><span class=m>100</span><span class=w> </span>looping<span class=w> </span>VUs<span class=w> </span><span class=k>for</span><span class=w> </span>2m0s<span class=w> </span>over<span class=w> </span><span class=m>3</span><span class=w> </span>stages<span class=w> </span><span class=o>(</span>gracefulRampDown:<span class=w> </span>30s,<span class=w> </span>gracefulStop:<span class=w> </span>30s<span class=o>)</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w> </span><span class=w> </span>GET<span class=w> </span>/book<span class=w> </span>with<span class=w> </span>guest<span class=w> </span>token
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>   </span><span class=w> </span>is<span class=w> </span>status<span class=w> </span><span class=m>200</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w> </span>checks.........................:<span class=w> </span><span class=m>100</span>.00%<span class=w> </span><span class=w> </span><span class=m>8655</span><span class=w>      </span><span class=w> </span><span class=m>0</span><span class=w>    </span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w> </span>data_received..................:<span class=w> </span><span class=m>2</span>.4<span class=w> </span>MB<span class=w>  </span><span class=m>20</span><span class=w> </span>kB/s
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w> </span>data_sent......................:<span class=w> </span><span class=m>2</span>.4<span class=w> </span>MB<span class=w>  </span><span class=m>20</span><span class=w> </span>kB/s
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w> </span>group_duration.................:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>46</span>.54ms<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>4</span>.59ms<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>29</span>.69ms<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>337</span>.79ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>109</span>.35ms<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>140</span>.51ms
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w> </span>http_req_blocked...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>11</span>.88s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>1</span>.21s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>4</span>.15s<span class=w>  </span><span class=nv>max</span><span class=o>=</span><span class=m>2</span>.83ms<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>9</span>.87s<span class=w>   </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>11</span>.4s<span class=w>  </span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w> </span>http_req_connecting............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>4</span>.98s<span class=w>  </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>max</span><span class=o>=</span><span class=m>2</span>.18ms<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w> </span>http_req_duration..............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>46</span>.37ms<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>4</span>.49ms<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>29</span>.49ms<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>337</span>.69ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>109</span>.26ms<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>140</span>.28ms
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=w>   </span><span class=o>{</span><span class=w> </span>expected_response:true<span class=w> </span><span class=o>}</span>...:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>46</span>.37ms<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>4</span>.49ms<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>29</span>.49ms<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>337</span>.69ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>109</span>.26ms<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>140</span>.28ms
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=w> </span>http_req_failed................:<span class=w> </span><span class=m>0</span>.00%<span class=w>   </span><span class=w> </span><span class=m>0</span><span class=w>         </span><span class=w> </span><span class=m>8655</span><span class=w> </span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=w> </span>http_req_receiving.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>65</span>.19s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>11</span>.14s<span class=w> </span><span class=nv>med</span><span class=o>=</span><span class=m>56</span>.47s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>5</span>.58ms<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>102</span>.86s<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>145</span>.19s
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=w> </span>http_req_sending...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>30</span>.35s<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>5</span>.43s<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>18</span>.48s<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>5</span>.29ms<span class=w>   </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>46</span>.63s<span class=w>  </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>58s<span class=w>    </span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a><span class=w> </span>http_req_tls_handshaking.......:<span class=w> </span><span class=nv>avg</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>min</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>med</span><span class=o>=</span>0s<span class=w>      </span><span class=nv>max</span><span class=o>=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span>0s<span class=w>       </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span>0s<span class=w>      </span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a><span class=w> </span>http_req_waiting...............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>46</span>.27ms<span class=w> </span><span class=nv>min</span><span class=o>=</span><span class=m>4</span>.43ms<span class=w>  </span><span class=nv>med</span><span class=o>=</span><span class=m>29</span>.42ms<span class=w> </span><span class=nv>max</span><span class=o>=</span><span class=m>337</span>.65ms<span class=w> </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>109</span>.22ms<span class=w> </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>140</span>.24ms
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a><span class=w> </span>http_reqs......................:<span class=w> </span><span class=m>8655</span><span class=w>    </span><span class=m>71</span>.999297/s
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a><span class=w> </span>iteration_duration.............:<span class=w> </span><span class=nv>avg</span><span class=o>=</span><span class=m>1</span>.04s<span class=w>   </span><span class=nv>min</span><span class=o>=</span>1s<span class=w>      </span><span class=nv>med</span><span class=o>=</span><span class=m>1</span>.03s<span class=w>   </span><span class=nv>max</span><span class=o>=</span><span class=m>1</span>.33s<span class=w>    </span>p<span class=o>(</span><span class=m>90</span><span class=o>)=</span><span class=m>1</span>.11s<span class=w>    </span>p<span class=o>(</span><span class=m>95</span><span class=o>)=</span><span class=m>1</span>.14s<span class=w>   </span>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a><span class=w> </span>iterations.....................:<span class=w> </span><span class=m>8655</span><span class=w>    </span><span class=m>71</span>.999297/s
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a><span class=w> </span>vus............................:<span class=w> </span><span class=m>2</span><span class=w>       </span><span class=nv>min</span><span class=o>=</span><span class=m>2</span><span class=w>       </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a><span class=w> </span>vus_max........................:<span class=w> </span><span class=m>100</span><span class=w>     </span><span class=nv>min</span><span class=o>=</span><span class=m>100</span><span class=w>     </span><span class=nv>max</span><span class=o>=</span><span class=m>100</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a>running<span class=w> </span><span class=o>(</span>2m00.2s<span class=o>)</span>,<span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs,<span class=w> </span><span class=m>8655</span><span class=w> </span><span class=nb>complete</span><span class=w> </span>and<span class=w> </span><span class=m>0</span><span class=w> </span>interrupted<span class=w> </span>iterations
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a>default<span class=w> </span><span class=w> </span><span class=o>[======================================]</span><span class=w> </span><span class=m>000</span>/100<span class=w> </span>VUs<span class=w>  </span>2m0s
</span></code></pre></div> </li> </ul> <h2 id=measuring-performance>Measuring Performance<a class=headerlink href=#measuring-performance title="Permanent link">&para;</a></h2> <p>The following metrics should be measured to evaluate the performance impact of the Kyverno Authz Server:</p> <ul> <li> <p><strong>End-to-end latency</strong></p> <p>The end-to-end latency represents the time taken for a request to complete, from the client sending the request to receiving the response. Based on the k6 results, the average end-to-end latency for the different scenarios is as follows:</p> <ul> <li>App Only: <code>avg=1.01ms</code> (from <code>group_duration</code> or <code>http_req_duration</code>)</li> <li>App and Envoy: <code>avg=2.38ms</code> (from <code>http_req_duration</code>)</li> <li>App, Envoy, and Kyverno Authz Server: <code>avg=46.37ms</code> (from <code>http_req_duration</code>)</li> </ul> </li> <li> <p><strong>Kyverno evaluation latency</strong></p> <p>The Kyverno evaluation latency represents the time taken by the Kyverno Authz Server to evaluate the request against the configured policies. While the k6 results do not directly provide this metric, an estimate can be inferred by analyzing the differences in latency between the "App and Envoy" scenario and the "App, Envoy, and Kyverno Authz Server" scenario.</p> <p>The difference in average latency between these two scenarios is: <code>46.37ms</code> - <code>2.38ms</code> = <code>43.99ms</code></p> <p>This difference can be attributed to the Kyverno evaluation latency and the gRPC server handler latency combined. Assuming the gRPC server handler latency is relatively small compared to the Kyverno evaluation latency, the estimated range for the Kyverno evaluation latency is around 40ms to 45ms.</p> </li> <li> <p><strong>Resource utilization</strong></p> <p>Refers to CPU and memory usage of the Kyverno Authz Server container , <code>kubectl top</code> utility can be laveraged to measure the resource utilization.</p> <p>Get the resource utilization of the Kyverno Authz Server container using the following command:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>$<span class=w> </span>kubectl<span class=w> </span>top<span class=w> </span>pod<span class=w> </span>-n<span class=w> </span>demo<span class=w> </span>--containers
</span></code></pre></div> <p>To monitor resource utilization overtime use the following command:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>$<span class=w> </span>watch<span class=w> </span>-n<span class=w> </span><span class=m>1</span><span class=w> </span><span class=s2>&quot;kubectl top pod -n demo --containers&quot;</span>
</span></code></pre></div> <p>Now run the k6 script in different terminal window and observe the resource utilization of the Kyverno Authz Server container.</p> <p>Initial resource utilization of the Kyverno Authz Server container:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>POD<span class=w>                        </span>NAME<span class=w>                   </span>CPU<span class=o>(</span>cores<span class=o>)</span><span class=w>   </span>MEMORY<span class=o>(</span>bytes<span class=o>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>envoy<span class=w>                  </span>4m<span class=w>           </span>70Mi
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>server<span class=w>                 </span>1m<span class=w>           </span>51Mi
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>test-application<span class=w>       </span>1m<span class=w>           </span>11Mi
</span></code></pre></div> <p>Resource utilization of the Kyverno Authz Server container after 100 requests:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>POD<span class=w>                        </span>NAME<span class=w>                   </span>CPU<span class=o>(</span>cores<span class=o>)</span><span class=w>   </span>MEMORY<span class=o>(</span>bytes<span class=o>)</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>envoy<span class=w>                  </span>110m<span class=w>         </span>70Mi
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>server<span class=w>                 </span>895m<span class=w>         </span>60Mi
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>test-application<span class=w>       </span>17m<span class=w>          </span>15Mi
</span></code></pre></div> <p>Observations:</p> <ul> <li>The CPU utilization of the Kyverno Authz Server container increased significantly from 1m to 895m after receiving 100 requests during the load test.</li> <li>The memory utilization also increased, but to a lesser extent, from 51Mi to 60Mi.</li> </ul> <p>Resource utilization of the Kyverno Authz Server container after load completion:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>POD<span class=w>                        </span>NAME<span class=w>                   </span>CPU<span class=o>(</span>cores<span class=o>)</span><span class=w>   </span>MEMORY<span class=o>(</span>bytes<span class=o>)</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>envoy<span class=w>                  </span>4m<span class=w>           </span>70Mi
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>server<span class=w>                 </span>1m<span class=w>           </span>51Mi
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>testapp-5955cd6f8b-dbvgd<span class=w>   </span>test-application<span class=w>       </span>1m<span class=w>           </span>11Mi
</span></code></pre></div> </li> </ul> <p>Observations:</p> <ul> <li>After the load test completed and the request volume returned to normal levels, the CPU and memory utilization of the Kyverno Authz Server container returned to their initial values. This indicates that the Kyverno Authz Server can efficiently handle the increased load during the test and release the additional resources when the load subsides.</li> </ul> <p>Correlation with k6 results:</p> <ul> <li>The k6 script simulated a load test scenario with 100 virtual users, ramping up over 30 seconds, staying at 100 users for 1 minute, and then ramping down over 30 seconds.</li> <li>During the load test, when the request volume was at its peak (100 virtual users), the Kyverno Authz Server container experienced a significant increase in CPU utilization, reaching 895m.</li> <li>This CPU utilization spike aligns with the increased processing demand on the Kyverno Authz Server to evaluate the incoming requests against the configured Kyverno policies.</li> <li>The memory utilization increase during the load test was relatively modest, suggesting that the policy evaluation did not significantly impact the memory requirements of the Kyverno Authz Server.</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with  by Kyverno contributors. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/kyverno/kyverno-envoy-plugin target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://kubernetes.slack.com/archives/CLGR9BJU9 target=_blank rel=noopener title=kubernetes.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"/></svg> </a> <a href=https://twitter.com/kyverno target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.action.edit", "content.action.view", "navigation.footer", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../static/repo-card.js defer></script> </body> </html>